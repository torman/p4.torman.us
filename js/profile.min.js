$('input[class=headcount]').each(function() {
	$(this).keyup(function(){
		var intRegex = /^\d+$/;
		if (!intRegex.test(this.value) && (this.value != "")) {
			alert("Please enter a positive integer");
			this.value = "";
			return;
		}
		
		calTotalHeadcount();
		calBalance();
		// build_family_data_link();
	});
});

function calTotalHeadcount() {
	var sum = 0;
	//		$('input').each(function() {
	$('input[class=headcount]').each(function() {
		if(!isNaN(this.value) && this.value.length!=0) {
			sum += parseInt(this.value);
		}
	});

	$(".total_headcount").html(sum);
};

$('input[class=senior]').each(function() {
	$(this).keyup(function(){   
		var intRegex = /^\d+$/;
		if (!intRegex.test(this.value) && (this.value != "")) {
			alert("Please enter a positive integer");
			this.value = "";
			return;
		}

		calTotalSenior();
		calBalance();
	});
});

function calTotalSenior() {
	var sum = 0;
	// $('input').each(function() {
	$('input[class=senior]').each(function() {
		if(!isNaN(this.value) && this.value.length!=0) {
			sum += parseInt(this.value);
		}
	});

	$(".total_senior").html(sum);
}

$('input[class=children]').each(function() {
	$(this).keyup(function(){   
		var intRegex = /^\d+$/;
		if (!intRegex.test(this.value) && (this.value != "")) {
			alert("Please enter a positive integer");
			this.value = "";
			return;
		}
		
		calTotalChildren();
		calBalance();
	});
});

function calTotalChildren() {
	var sum = 0;
	// $('input').each(function() {
	$('input[class=children]').each(function() {
		if(!isNaN(this.value) && this.value.length!=0) {
			sum += parseInt(this.value);
		}
	});

	$(".total_children").html(sum);
}

$('input[class=expenses]').each(function() {
	$(this).keyup(function(){
	
		calTotalExpenses();
		calBalance();
	});
});

function calTotalExpenses() {
	var sum = 0;
	// $('input').each(function() {
	$('input[class=expenses]').each(function() {
		if(!isNaN(this.value) && this.value.length!=0) {
			sum += parseFloat(this.value);
		}
	});

	$(".total_expenses").html(sum.toFixed(2));
}

function calBalance() {
	var totalHeadcount = $(".total_headcount").html();
	var totalSenior = $(".total_senior").html();
	var totalChild = $(".total_children").html();
	var totalExpenses = $(".total_expenses").html();
	var totalHeadNeedToPay = totalHeadcount - totalSenior - totalChild;
	var feePerPerson = totalExpenses / totalHeadNeedToPay;
	
	// console.log(feePerPerson);
	// var rowCount = $('#table_hc >tbody >tr').length;
	// console.log(rowCount);
	
	$('.family').each (function() {
			
		var headcount = $(this).children().eq(1).find('input').val(); 
//		console.log(headcount);
		var senior = $(this).children().eq(2).find('input').val(); 
//		console.log(senior);	
		var children = $(this).children().eq(3).find('input').val(); 
//		console.log(children);	
		var expenses = $(this).children().eq(4).find('input').val(); 
//		console.log(expenses);
		
		balance =  ( headcount - senior - children ) * feePerPerson - expenses ;
		if (balance > 0) {
			$(this).children().eq(5).css({'color':'red'});
		} else {
			$(this).children().eq(5).css({'color':'black'});
		}
		console.log (balance);
		$(this).children().eq(5).html(balance.toFixed(2));
	});

}

function calOnLoad() {

	calTotalHeadcount();
	calTotalSenior();
	calTotalChildren();
	calTotalExpenses();
	calBalance();
};

var family_data;
$('.family_name').click(function() {
	family_data = $(this).parent().attr('id'); 
	family_data = family_data + "," + $.trim($(this).html());
	var next_cell = $(this).next('td');
	family_data = family_data + "," + next_cell.find('input').val();
	next_cell = next_cell.next('td');
	family_data = family_data + "," + next_cell.find('input').val();
	next_cell = next_cell.next('td');
	family_data = family_data + "," + next_cell.find('input').val();
	next_cell = next_cell.next('td');
	family_data = family_data + "," + next_cell.find('input').val();
	var link = '<a href="/operations/family_edit/' + family_data + '">' + $(this).html() + '</a>';
	$(this).html(link);
	console.log(link);
	
});

// function build_family_data_link () {

	// var family_data;
	// family_data = $(this).parent().attr('id');

	// family_data = family_data + "," + $.trim($(this).html());
	// var next_cell = $(this).next('td');    
	// family_data = family_data + "," + next_cell.find('input').val();
	// next_cell = next_cell.next('td');      
	// family_data = family_data + "," + next_cell.find('input').val();
	// next_cell = next_cell.next('td');      
	// family_data = family_data + "," + next_cell.find('input').val();
	// next_cell = next_cell.next('td');      
	// family_data = family_data + "," + next_cell.find('input').val();
	// var link = '<a href="/operations/family_edit/' + family_data + '">' + $(this).html() + '</a>';
	                                       
	// console.log(link);                     
	// $(this).parent().children[0].val(link);
                                          
                                           
                                           